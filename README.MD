# Calendar

Version: 1.0.

Author: Andrei Kladkevich

2024

## Бизнес-требования
Сервис производственного календаря.

1) Функциональные требования:
1.1. Сервис должен с настроенной периодичностью выполнять синхронизацию данных производственного календаря из внешнего источника https://xmlcalendar.ru/, с сохранением изменений в БД.
1.2. При наличии изменений, должно формироваться уведомление через брокер сообщений.
1.3. Сервис должен предоставлять REST API со следующими эндпоинтами:
- Запуск синхронизации по запросу
- Информация о последней синхронизации: дата, время и результат синхронизации, исходный текст сообщения (если было получено)
- Получение информации о типе дня на заданную дату
- Получение информации о количестве рабочих и нерабочих дней в году

2) Иные требования:
2.1. Репозиторий должен содержать Dockerfile и docker-compose файл с описанием внешних приложений (DB, брокер сообщений)

3) Компоненты:
3.1. Сервис загрузки производственного календаря
3.2. DB
3.3. AMQ / RabbitMq

## Реализация

### Модель данных
Сущности.

CalendarOriginal.
Атрибуты:
  id - идентификатор записи
  country - страна календаря
  year - год календаря
  dateTime - дата создания записи
  status - статус записи (из справочника RecordStatus)
  isArchived - признак архивной записи
  data - данные календаря в исходном виде
Индексы:
  country, year, isArchived
  
RecordStatus.
Значения:
  NEW - новая запись
  PROCESSED - обработанная запись
  
CalendarFinalMonth.
Атрибуты:
  id - идентификатор записи
  country - страна календаря
  year - год календаря
  month - месяц календаря
  days - данные ключа days по конкретному месяцу
  dateTime - дата создания записи
  status - статус записи (из справочника RecordStatus)
  isArchived - признак архивной записи
Индексы:
  country, year, month, isArchived

### Use Cases
Описание - в файле CalendarUseCases.txt.

### Пояснения
Реализовано:
1. Планировщик для загрузки календаря из внешнего источника. Точка входа: класс CalendarOriginalScheduler, метод loadCalendarOriginalAll.
2. Использование RabbitMQ для отправки/получения сообщений по загрузке данных календаря. Описание очередей - в файле RabbitConfig.java.
3. REST API для получения информации о типе дня на заданную дату. Точка входа: класс CalendarResourceController, метод getDayType.
4. docker-compose файл с описанием внешних приложений (Postgres, RabbitMQ).